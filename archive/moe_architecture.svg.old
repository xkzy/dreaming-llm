<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 1400" width="1200" height="1400">
  <!-- Title -->
  <text x="600" y="40" font-size="28" font-weight="bold" text-anchor="middle" fill="#1a1a1a">
    MoE Multi-Modal LLM Architecture
  </text>
  <text x="600" y="70" font-size="16" text-anchor="middle" fill="#666">
    Mixture-of-Experts with Vision, Graph, and Text Reasoning
  </text>
  
  <!-- Input Layer -->
  <rect x="50" y="100" width="1100" height="120" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="10"/>
  <text x="600" y="130" font-size="20" font-weight="bold" text-anchor="middle" fill="#1976d2">
    Input Layer
  </text>
  
  <!-- Image Triplets -->
  <rect x="100" y="145" width="150" height="60" fill="#fff" stroke="#42a5f5" stroke-width="2" rx="5"/>
  <text x="175" y="170" font-size="14" font-weight="bold" text-anchor="middle" fill="#1976d2">What Image</text>
  <text x="175" y="190" font-size="12" text-anchor="middle" fill="#666">(3, 224, 224)</text>
  
  <rect x="280" y="145" width="150" height="60" fill="#fff" stroke="#42a5f5" stroke-width="2" rx="5"/>
  <text x="355" y="170" font-size="14" font-weight="bold" text-anchor="middle" fill="#1976d2">Action Image</text>
  <text x="355" y="190" font-size="12" text-anchor="middle" fill="#666">(3, 224, 224)</text>
  
  <rect x="460" y="145" width="150" height="60" fill="#fff" stroke="#42a5f5" stroke-width="2" rx="5"/>
  <text x="535" y="170" font-size="14" font-weight="bold" text-anchor="middle" fill="#1976d2">Result Image</text>
  <text x="535" y="190" font-size="12" text-anchor="middle" fill="#666">(3, 224, 224)</text>
  
  <!-- Text Prompt -->
  <rect x="650" y="145" width="200" height="60" fill="#fff" stroke="#42a5f5" stroke-width="2" rx="5"/>
  <text x="750" y="170" font-size="14" font-weight="bold" text-anchor="middle" fill="#1976d2">Text Prompt</text>
  <text x="750" y="190" font-size="12" text-anchor="middle" fill="#666">"Describe scene"</text>
  
  <!-- Graph Context -->
  <rect x="880" y="145" width="200" height="60" fill="#fff" stroke="#42a5f5" stroke-width="2" rx="5"/>
  <text x="980" y="170" font-size="14" font-weight="bold" text-anchor="middle" fill="#1976d2">Graph Context</text>
  <text x="980" y="190" font-size="12" text-anchor="middle" fill="#666">Seed Nodes</text>
  
  <!-- Arrows from input to vision experts -->
  <line x1="175" y1="205" x2="175" y2="250" stroke="#1976d2" stroke-width="2" marker-end="url(#arrowblue)"/>
  <line x1="355" y1="205" x2="355" y2="250" stroke="#1976d2" stroke-width="2" marker-end="url(#arrowblue)"/>
  <line x1="535" y1="205" x2="535" y2="250" stroke="#1976d2" stroke-width="2" marker-end="url(#arrowblue)"/>
  <line x1="750" y1="205" x2="750" y2="470" stroke="#1976d2" stroke-width="2" marker-end="url(#arrowblue)"/>
  <line x1="980" y1="205" x2="980" y2="660" stroke="#1976d2" stroke-width="2" marker-end="url(#arrowblue)"/>
  
  <!-- Vision Expert Layer -->
  <rect x="50" y="250" width="600" height="200" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="10"/>
  <text x="350" y="280" font-size="20" font-weight="bold" text-anchor="middle" fill="#f57c00">
    Vision Expert Layer (MoE)
  </text>
  
  <!-- CLIP Encoder -->
  <rect x="100" y="295" width="180" height="60" fill="#fff" stroke="#ff9800" stroke-width="2" rx="5"/>
  <text x="190" y="318" font-size="13" font-weight="bold" text-anchor="middle" fill="#f57c00">CLIP Encoder</text>
  <text x="190" y="335" font-size="11" text-anchor="middle" fill="#666">ViT-B/32</text>
  <text x="190" y="348" font-size="10" text-anchor="middle" fill="#999">Output: 512-dim</text>
  
  <!-- Vision Expert 1 -->
  <rect x="100" y="370" width="85" height="60" fill="#ffe0b2" stroke="#ff9800" stroke-width="2" rx="5"/>
  <text x="142" y="393" font-size="12" font-weight="bold" text-anchor="middle" fill="#f57c00">Expert 1</text>
  <text x="142" y="410" font-size="10" text-anchor="middle" fill="#666">Spatial</text>
  <text x="142" y="423" font-size="10" text-anchor="middle" fill="#666">Analysis</text>
  
  <!-- Vision Expert 2 -->
  <rect x="195" y="370" width="85" height="60" fill="#ffe0b2" stroke="#ff9800" stroke-width="2" rx="5"/>
  <text x="237" y="393" font-size="12" font-weight="bold" text-anchor="middle" fill="#f57c00">Expert 2</text>
  <text x="237" y="410" font-size="10" text-anchor="middle" fill="#666">Semantic</text>
  <text x="237" y="423" font-size="10" text-anchor="middle" fill="#666">Features</text>
  
  <!-- Vision Gating Network -->
  <rect x="300" y="370" width="120" height="60" fill="#ffcc80" stroke="#ff6f00" stroke-width="2" rx="5"/>
  <text x="360" y="393" font-size="12" font-weight="bold" text-anchor="middle" fill="#e65100">Gating Net</text>
  <text x="360" y="410" font-size="10" text-anchor="middle" fill="#666">Weights:</text>
  <text x="360" y="423" font-size="10" text-anchor="middle" fill="#666">[w₁, w₂]</text>
  
  <!-- Fused Vision Output -->
  <rect x="440" y="370" width="180" height="60" fill="#fff" stroke="#ff9800" stroke-width="2" rx="5"/>
  <text x="530" y="393" font-size="13" font-weight="bold" text-anchor="middle" fill="#f57c00">Fused Vision</text>
  <text x="530" y="410" font-size="11" text-anchor="middle" fill="#666">∑(wᵢ × expertᵢ)</text>
  <text x="530" y="423" font-size="10" text-anchor="middle" fill="#999">512-dim embedding</text>
  
  <!-- Arrows within vision layer -->
  <line x1="190" y1="355" x2="142" y2="370" stroke="#ff9800" stroke-width="1.5"/>
  <line x1="190" y1="355" x2="237" y2="370" stroke="#ff9800" stroke-width="1.5"/>
  <line x1="142" y1="430" x2="300" y2="400" stroke="#ff9800" stroke-width="1.5"/>
  <line x1="237" y1="430" x2="300" y2="400" stroke="#ff9800" stroke-width="1.5"/>
  <line x1="420" y1="400" x2="440" y2="400" stroke="#ff9800" stroke-width="2" marker-end="url(#arroworange)"/>
  
  <!-- Arrow from vision to memory -->
  <line x1="530" y1="430" x2="530" y2="480" stroke="#f57c00" stroke-width="2" marker-end="url(#arroworange)"/>
  
  <!-- Text Expert Layer -->
  <rect x="650" y="470" width="500" height="170" fill="#e8f5e9" stroke="#388e3c" stroke-width="2" rx="10"/>
  <text x="900" y="500" font-size="20" font-weight="bold" text-anchor="middle" fill="#388e3c">
    Text Expert Layer (MoE)
  </text>
  
  <!-- Text Expert 1 -->
  <rect x="690" y="520" width="100" height="60" fill="#c8e6c9" stroke="#66bb6a" stroke-width="2" rx="5"/>
  <text x="740" y="543" font-size="12" font-weight="bold" text-anchor="middle" fill="#388e3c">Expert 1</text>
  <text x="740" y="560" font-size="10" text-anchor="middle" fill="#666">Language</text>
  <text x="740" y="573" font-size="10" text-anchor="middle" fill="#666">Modeling</text>
  
  <!-- Text Expert 2 -->
  <rect x="800" y="520" width="100" height="60" fill="#c8e6c9" stroke="#66bb6a" stroke-width="2" rx="5"/>
  <text x="850" y="543" font-size="12" font-weight="bold" text-anchor="middle" fill="#388e3c">Expert 2</text>
  <text x="850" y="560" font-size="10" text-anchor="middle" fill="#666">Context</text>
  <text x="850" y="573" font-size="10" text-anchor="middle" fill="#666">Integration</text>
  
  <!-- Text Gating Network -->
  <rect x="920" y="520" width="100" height="60" fill="#a5d6a7" stroke="#2e7d32" stroke-width="2" rx="5"/>
  <text x="970" y="543" font-size="12" font-weight="bold" text-anchor="middle" fill="#1b5e20">Gating</text>
  <text x="970" y="560" font-size="10" text-anchor="middle" fill="#666">[w₁, w₂]</text>
  
  <!-- Fused Text Output -->
  <rect x="690" y="595" width="330" height="35" fill="#fff" stroke="#66bb6a" stroke-width="2" rx="5"/>
  <text x="855" y="618" font-size="12" font-weight="bold" text-anchor="middle" fill="#388e3c">
    Fused Text: ∑(wᵢ × expertᵢ) → 512-dim
  </text>
  
  <!-- Arrows within text layer -->
  <line x1="740" y1="580" x2="920" y2="550" stroke="#66bb6a" stroke-width="1.5"/>
  <line x1="850" y1="580" x2="920" y2="550" stroke="#66bb6a" stroke-width="1.5"/>
  <line x1="855" y1="580" x2="855" y2="595" stroke="#66bb6a" stroke-width="2"/>
  
  <!-- Arrow from text to memory -->
  <line x1="855" y1="630" x2="855" y2="680" stroke="#388e3c" stroke-width="2" marker-end="url(#arrowgreen)"/>
  
  <!-- Graph Expert Layer -->
  <rect x="700" y="680" width="450" height="190" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="10"/>
  <text x="925" y="710" font-size="20" font-weight="bold" text-anchor="middle" fill="#7b1fa2">
    Graph Expert Layer (MoE)
  </text>
  
  <!-- Graph Expert 1 -->
  <rect x="740" y="730" width="100" height="60" fill="#e1bee7" stroke="#ab47bc" stroke-width="2" rx="5"/>
  <text x="790" y="753" font-size="12" font-weight="bold" text-anchor="middle" fill="#7b1fa2">Expert 1</text>
  <text x="790" y="770" font-size="10" text-anchor="middle" fill="#666">Multi-hop</text>
  <text x="790" y="783" font-size="10" text-anchor="middle" fill="#666">Traversal</text>
  
  <!-- Graph Expert 2 -->
  <rect x="850" y="730" width="100" height="60" fill="#e1bee7" stroke="#ab47bc" stroke-width="2" rx="5"/>
  <text x="900" y="753" font-size="12" font-weight="bold" text-anchor="middle" fill="#7b1fa2">Expert 2</text>
  <text x="900" y="770" font-size="10" text-anchor="middle" fill="#666">Attention</text>
  <text x="900" y="783" font-size="10" text-anchor="middle" fill="#666">Aggregation</text>
  
  <!-- Graph Gating Network -->
  <rect x="970" y="730" width="100" height="60" fill="#ce93d8" stroke="#6a1b9a" stroke-width="2" rx="5"/>
  <text x="1020" y="753" font-size="12" font-weight="bold" text-anchor="middle" fill="#4a148c">Gating</text>
  <text x="1020" y="770" font-size="10" text-anchor="middle" fill="#666">[w₁, w₂]</text>
  
  <!-- Graph RAG -->
  <rect x="740" y="805" width="210" height="50" fill="#fff" stroke="#ab47bc" stroke-width="2" rx="5"/>
  <text x="845" y="825" font-size="12" font-weight="bold" text-anchor="middle" fill="#7b1fa2">Graph RAG</text>
  <text x="845" y="843" font-size="10" text-anchor="middle" fill="#666">Knowledge retrieval → 512-dim</text>
  
  <!-- Arrows within graph layer -->
  <line x1="790" y1="790" x2="970" y2="760" stroke="#ab47bc" stroke-width="1.5"/>
  <line x1="900" y1="790" x2="970" y2="760" stroke="#ab47bc" stroke-width="1.5"/>
  <line x1="845" y1="790" x2="845" y2="805" stroke="#ab47bc" stroke-width="2"/>
  
  <!-- Arrow from graph to memory -->
  <line x1="845" y1="855" x2="845" y2="900" stroke="#7b1fa2" stroke-width="2" marker-end="url(#arrowpurple)"/>
  
  <!-- Memory Integration Layer -->
  <rect x="400" y="900" width="450" height="120" fill="#fff9c4" stroke="#f57f17" stroke-width="2" rx="10"/>
  <text x="625" y="930" font-size="20" font-weight="bold" text-anchor="middle" fill="#f57f17">
    Memory Integration
  </text>
  
  <rect x="430" y="945" width="380" height="60" fill="#fff" stroke="#fbc02d" stroke-width="2" rx="5"/>
  <text x="620" y="968" font-size="13" font-weight="bold" text-anchor="middle" fill="#f57f17">
    Fused Multi-Modal Memory
  </text>
  <text x="620" y="988" font-size="11" text-anchor="middle" fill="#666">
    vision_emb + text_emb + graph_emb
  </text>
  <text x="620" y="1002" font-size="10" text-anchor="middle" fill="#999">
    Shape: (batch, 512)
  </text>
  
  <!-- Arrows to memory -->
  <line x1="530" y1="480" x2="530" y2="900" stroke="#f57c00" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="530" y1="900" x2="580" y2="945" stroke="#f57c00" stroke-width="2" marker-end="url(#arroworange)"/>
  
  <line x1="855" y1="680" x2="680" y2="945" stroke="#388e3c" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowgreen)"/>
  
  <!-- Transformer Decoder -->
  <rect x="300" y="1050" width="600" height="140" fill="#fce4ec" stroke="#c2185b" stroke-width="2" rx="10"/>
  <text x="600" y="1080" font-size="20" font-weight="bold" text-anchor="middle" fill="#c2185b">
    Transformer Decoder
  </text>
  
  <rect x="340" y="1100" width="160" height="70" fill="#f8bbd0" stroke="#e91e63" stroke-width="2" rx="5"/>
  <text x="420" y="1125" font-size="13" font-weight="bold" text-anchor="middle" fill="#c2185b">Self-Attention</text>
  <text x="420" y="1142" font-size="10" text-anchor="middle" fill="#666">8 heads</text>
  <text x="420" y="1157" font-size="10" text-anchor="middle" fill="#666">Causal masking</text>
  
  <rect x="520" y="1100" width="160" height="70" fill="#f8bbd0" stroke="#e91e63" stroke-width="2" rx="5"/>
  <text x="600" y="1125" font-size="13" font-weight="bold" text-anchor="middle" fill="#c2185b">Cross-Attention</text>
  <text x="600" y="1142" font-size="10" text-anchor="middle" fill="#666">Attend to</text>
  <text x="600" y="1157" font-size="10" text-anchor="middle" fill="#666">memory</text>
  
  <rect x="700" y="1100" width="160" height="70" fill="#f8bbd0" stroke="#e91e63" stroke-width="2" rx="5"/>
  <text x="780" y="1125" font-size="13" font-weight="bold" text-anchor="middle" fill="#c2185b">Feed-Forward</text>
  <text x="780" y="1142" font-size="10" text-anchor="middle" fill="#666">MLP layers</text>
  <text x="780" y="1157" font-size="10" text-anchor="middle" fill="#666">GELU activation</text>
  
  <!-- Arrow from memory to decoder -->
  <line x1="625" y1="1020" x2="600" y2="1050" stroke="#f57f17" stroke-width="3" marker-end="url(#arrowyellow)"/>
  
  <!-- Arrow through decoder -->
  <line x1="500" y1="1135" x2="520" y2="1135" stroke="#e91e63" stroke-width="2" marker-end="url(#arrowpink)"/>
  <line x1="680" y1="1135" x2="700" y2="1135" stroke="#e91e63" stroke-width="2" marker-end="url(#arrowpink)"/>
  
  <!-- Output Layer -->
  <rect x="350" y="1220" width="500" height="120" fill="#e0f2f1" stroke="#00796b" stroke-width="2" rx="10"/>
  <text x="600" y="1250" font-size="20" font-weight="bold" text-anchor="middle" fill="#00796b">
    Output Generation
  </text>
  
  <rect x="390" y="1270" width="420" height="50" fill="#fff" stroke="#26a69a" stroke-width="2" rx="5"/>
  <text x="600" y="1293" font-size="14" font-weight="bold" text-anchor="middle" fill="#00796b">
    Generated Text: "A person is opening a door..."
  </text>
  <text x="600" y="1310" font-size="11" text-anchor="middle" fill="#666">
    Token-by-token decoding with beam search
  </text>
  
  <!-- Arrow to output -->
  <line x1="600" y1="1190" x2="600" y2="1220" stroke="#c2185b" stroke-width="3" marker-end="url(#arrowpink)"/>
  
  <!-- RL Feedback Loop -->
  <path d="M 850 1295 Q 950 1200 950 1050" fill="none" stroke="#ff5722" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowred)"/>
  <text x="970" y="1170" font-size="12" fill="#ff5722" font-weight="bold">RL Feedback</text>
  <text x="970" y="1185" font-size="10" fill="#666">Policy gradient</text>
  
  <!-- Legend -->
  <rect x="50" y="1230" width="250" height="140" fill="#f5f5f5" stroke="#666" stroke-width="1" rx="5"/>
  <text x="175" y="1255" font-size="16" font-weight="bold" text-anchor="middle" fill="#333">
    Key Features
  </text>
  
  <circle cx="70" cy="1275" r="5" fill="#ff9800"/>
  <text x="85" y="1280" font-size="11" fill="#333">Vision: CLIP ViT-B/32 (512-dim)</text>
  
  <circle cx="70" cy="1295" r="5" fill="#66bb6a"/>
  <text x="85" y="1300" font-size="11" fill="#333">Text: Transformer (512-dim)</text>
  
  <circle cx="70" cy="1315" r="5" fill="#ab47bc"/>
  <text x="85" y="1320" font-size="11" fill="#333">Graph: Multi-hop RAG (512-dim)</text>
  
  <circle cx="70" cy="1335" r="5" fill="#fbc02d"/>
  <text x="85" y="1340" font-size="11" fill="#333">MoE: 2 experts per modality</text>
  
  <circle cx="70" cy="1355" r="5" fill="#ff5722"/>
  <text x="85" y="1360" font-size="11" fill="#333">RL: Continuous learning loop</text>
  
  <!-- Arrow markers -->
  <defs>
    <marker id="arrowblue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#1976d2"/>
    </marker>
    <marker id="arroworange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#ff9800"/>
    </marker>
    <marker id="arrowgreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#66bb6a"/>
    </marker>
    <marker id="arrowpurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#ab47bc"/>
    </marker>
    <marker id="arrowyellow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#f57f17"/>
    </marker>
    <marker id="arrowpink" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#e91e63"/>
    </marker>
    <marker id="arrowred" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#ff5722"/>
    </marker>
  </defs>
</svg>
